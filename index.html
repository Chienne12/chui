<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo reCAPTCHA v2</title>
    <!-- Tải Tailwind CSS để tạo kiểu dáng -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Đảm bảo các tiện ích reCAPTCHA hiển thị đúng kích thước */
        .g-recaptcha {
            margin-top: 1rem;
            margin-bottom: 1rem;
            transform-origin: 0 0;
            /* Đôi khi cần điều chỉnh tỷ lệ cho vừa vặn */
            /* transform: scale(0.9); */
        }
    </style>

    <script type="text/javascript">
        // Khóa trang web THỬ NGHIỆM (TEST) của Google.
        // Khóa này ĐƯỢC THIẾT KẾ để LUÔN LUÔN hiển thị thử thách hình ảnh
        // và sẽ luôn vượt qua.
        const SITE_KEY = '6LeIxAcTAAAAAJcZVRqyHh71UMrdC-C-D-8SMmO-';

        // Biến để lưu trữ ID của các tiện ích
        var widgetId1;
        var widgetId2;

        // Hàm callback được gọi khi người dùng xác minh thành công (cho tiện ích 3)
        var verifyCallback = function(response) {
            console.log('verifyCallback đã kích hoạt. Response:', response);
            updateMessageBox('Tiện ích 3 (Callback): Xác minh thành công! Mã response đã được ghi vào Bảng điều khiển (Console).');
        };

        // Hàm chính được gọi khi API reCAPTCHA tải xong
        // (do tham số ?onload=onloadCallback trong URL script)
        var onloadCallback = function() {
            console.log("grecaptcha đã sẵn sàng!");
            updateMessageBox('API reCAPTCHA đã tải xong. Đang hiển thị các tiện ích...');

            // Hiển thị tiện ích đầu tiên (example1)
            // Lưu ID của tiện ích vào biến widgetId1
            widgetId1 = grecaptcha.render('example1', {
                'sitekey': SITE_KEY,
                'theme': 'light' // Giao diện sáng
            });

            // Hiển thị tiện ích thứ hai (example2)
            // Lần này, chúng ta truyền thẳng phần tử DOM
            widgetId2 = grecaptcha.render(document.getElementById('example2'), {
                'sitekey': SITE_KEY,
                'theme': 'dark' // Giao diện tối
            });

            // Hiển thị tiện ích thứ ba (example3)
            // Tiện ích này sử dụng hàm 'verifyCallback'
            grecaptcha.render('example3', {
                'sitekey': SITE_KEY,
                'callback': verifyCallback, // Tên hàm callback khi thành công
                'theme': 'light'
            });
        };

        // --- Các hàm trợ giúp cho Demo ---

        // Hàm để lấy response từ tiện ích 1 và hiển thị
        function getWidget1Response(event) {
            event.preventDefault(); // Ngăn form gửi đi
            const response = grecaptcha.getResponse(widgetId1);
            if (response.length === 0) {
                updateMessageBox('Tiện ích 1: Bạn chưa hoàn thành CAPTCHA.');
            } else {
                updateMessageBox('Tiện ích 1: Lấy response thành công! (Xem chi tiết trong Console)');
                console.log('Response từ Tiện ích 1:', response);
            }
        }

        // Hàm để đặt lại tiện ích 2
        function resetWidget2(event) {
            event.preventDefault(); // Ngăn form gửi đi
            grecaptcha.reset(widgetId2);
            updateMessageBox('Tiện ích 2: Đã đặt lại (reset).');
        }

        // Hàm cập nhật hộp thông báo (thay thế cho alert())
        function updateMessageBox(message) {
            const msgBox = document.getElementById('message-box');
            if (msgBox) {
                msgBox.innerText = message;
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans p-5 md:p-10">

    <div class="max-w-2xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-md">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">
            Demo reCAPTCHA v2 (Hiển thị rõ ràng)
        </h1>

        <!-- Hộp thông báo để hiển thị trạng thái -->
        <div id="message-box" class="mb-6 p-4 bg-gray-100 text-gray-700 rounded-md border border-gray-300 min-h-[50px] text-sm whitespace-pre-wrap">
            Đang chờ API reCAPTCHA tải...
        </div>

        <!-- Tiện ích 1: Lấy Response -->
        <div class="mb-8 p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Tiện ích 1 (Giao diện Sáng)</h2>
            <p class="text-sm text-gray-600 mb-4">Nhấn nút "Lấy Response" để lấy mã phản hồi sau khi xác minh.</p>
            <form onsubmit="getWidget1Response(event)">
                <div id="example1"></div>
                <input type="submit" value="Lấy Response" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-colors">
            </form>
        </div>

        <!-- Tiện ích 2: Đặt lại -->
        <div class="mb-8 p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Tiện ích 2 (Giao diện Tối)</h2>
            <p class="text-sm text-gray-600 mb-4">Nhấn nút "Đặt lại" để reset tiện ích này.</p>
            <form onsubmit="resetWidget2(event)">
                <div id="example2"></div>
                <input type="submit" value="Đặt lại" class="mt-4 w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-colors">
            </form>
        </div>

        <!-- Tiện ích 3: Gửi form (POST) với callback -->
        <div class="p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Tiện ích 3 (Gửi Form POST)</h2>
            <p class="text-sm text-gray-600 mb-4">Tiện ích này sẽ kích hoạt một hàm callback khi thành công và gửi form theo phương thức POST (sẽ tải lại trang demo này).</p>
            <!-- Form này sẽ POST về URL hiện tại (?) -->
            <form action="?" method="POST">
                <div id="example3"></div>
                <input type="submit" value="Gửi Form (Submit)" class="mt-4 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-colors">
            </form>
        </div>

    </div>

    <!-- 
      Tải API reCAPTCHA
      - onload=onloadCallback: Chỉ định hàm sẽ chạy khi API sẵn sàng.
      - render=explicit: Báo cho API rằng chúng ta sẽ tự hiển thị tiện ích bằng grecaptcha.render(),
        chứ không để API tự động tìm thẻ .g-recaptcha.
      - async defer: Giúp tải script mà không chặn hiển thị trang.
    -->
    <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"
        async defer>
    </script>

</body>
</html>
